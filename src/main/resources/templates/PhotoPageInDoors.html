<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë²„ë””ì˜ ì‹¤ë‚´ ì‚¬ì§„</title>
    <script>
        // í‚¤ë³´ë“œë¡œ ì‚¬ì§„ ë‘˜ëŸ¬ë³´ê¸°

        // ë¼ì´íŠ¸ë°•ìŠ¤ í‚¤ë³´ë“œë¡œ
        function initializeLightboxKeyboardNavigation() {
            const lightboxes = document.querySelectorAll('.lightbox');

            // í‚¤ë³´ë“œ ëˆŒë €ì„ë•Œ
            function handleKeyPress(event) {
                // í˜„ì¬ ë³´ì´ëŠ” ë¼ì´íŠ¸ë°•ìŠ¤
                const currentLightbox = document.querySelector('.lightbox:target');

                if (!currentLightbox) return; // ë¼ì´íŠ¸ë°•ìŠ¤ ì—†ì„ ì‹œ exit

                // í™”ì‚´í‘œ ëˆ„ë¥¼ì‹œ
                switch (event.key) {
                    case 'ArrowLeft':
                        navigateLightbox(currentLightbox, 'previous');
                        break;
                    case 'ArrowRight':
                        navigateLightbox(currentLightbox, 'next');
                        break;
                    case 'Escape':
                        closeLightbox();
                        break;
                    default:
                        return; // ë‹¤ë¥¸ í‚¤ ëˆ„ë¥¼ ì‹œ exit
                }
            }

            // ë¼ì´íŠ¸ë°•ìŠ¤ ì´ë¯¸ì§€ ì „í™˜
            function navigateLightbox(currentLightbox, direction) {
                const lightboxId = currentLightbox.id;
                const lightboxIndex = parseInt(lightboxId.match(/\d+/)[0]); // ì¸ë±ìŠ¤ ì¶”ì¶œ
                let newIndex;

                if (direction === 'next') {
                    newIndex = lightboxIndex % lightboxes.length + 1; // ë‹¤ìŒ ì‚¬ì§„
                } else if (direction === 'previous') {
                    newIndex = (lightboxIndex - 2 + lightboxes.length) % lightboxes.length + 1; // ì´ì „ ì‚¬ì§„
                }

                const newLightboxId = `lightbox${newIndex}`;
                const newLightbox = document.getElementById(newLightboxId);

                if (newLightbox) {
                    // í˜„ì¬ ë¼ì´íŠ¸ë°•ìŠ¤ ë‹«ê¸°
                    currentLightbox.style.display = 'none';

                    // ìƒˆ ë¼ì´íŠ¸ë°•ìŠ¤ ì—´ê¸°
                    newLightbox.style.display = 'flex';

                    // URL ê°±ì‹ 
                    history.replaceState(null, null, `#${newLightboxId}`);
                }
            }

            // ë¼ì´íŠ¸ë°•ìŠ¤ ë‹«ê¸° í•¨ìˆ˜
            function closeLightbox() {
                const currentLightbox = document.querySelector('.lightbox:target');
                if (currentLightbox) {
                    currentLightbox.style.display = 'none';
                    history.replaceState(null, null, window.location.pathname);
                }
            }

            // ë¼ì´íŠ¸ë°•ìŠ¤ í´ë¦­ ì‹œ ë‹«ê¸°
            lightboxes.forEach(lightbox => {
                lightbox.addEventListener('click', function(e) {
                    // ì´ë¯¸ì§€ê°€ ì•„ë‹Œ ë°°ê²½ì„ í´ë¦­í–ˆì„ ë•Œë§Œ ë‹«ê¸°
                    if (e.target === this) {
                        closeLightbox();
                    }
                });

                // ì´ë¯¸ì§€ í´ë¦­ ì‹œ ì „íŒŒ ë°©ì§€
                const img = lightbox.querySelector('img');
                if (img) {
                    img.addEventListener('click', function(e) {
                        e.stopPropagation();
                        closeLightbox(); // ì´ë¯¸ì§€ í´ë¦­ì‹œë„ ë‹«ê¸°
                    });
                }
            });

            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬ í•¨ìˆ˜
            document.addEventListener('keydown', handleKeyPress);
        }

        // í˜ì´ì§€ ì‹œì‘ ë•Œ ìœ„ í•¨ìˆ˜ ë¡œë“œ
        window.addEventListener('load', initializeLightboxKeyboardNavigation);

    </script>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/lightbox.css}">
    <link rel="stylesheet" th:href="@{/css/comments.css}">
</head>
<body>
<div class="login-area">
    <!-- ë¡œê·¸ì¸ ì•ˆ í•œ ìƒíƒœ -->
    <form sec:authorize="!isAuthenticated()" th:action="@{/login}" method="get">
        <button type="submit">ë¡œê·¸ì¸</button>
    </form>

    <!-- ë¡œê·¸ì¸ í•œ ìƒíƒœ -->
    <form sec:authorize="isAuthenticated()"
          th:action="@{/logout}" method="post">
        <span sec:authentication="principal.username">user</span>
        <button type="submit">ë¡œê·¸ì•„ì›ƒ</button>
    </form>
</div>
<header id="container">
    <h1>ë²„ë””ì˜ ì‹¤ë‚´ ì‚¬ì§„</h1>
</header>
<nav>
    <ul>
        <li><a th:href="@{/home}">í™ˆ</a></li>
        <li><a th:href="@{/photos}">ì‚¬ì§„</a></li>
        <li><a th:href="@{/videos}">ë™ì˜ìƒ</a></li>
        <li><a th:href="@{/info}">ì •ë³´</a></li>
    </ul>
</nav>

<!-- âœ… ê¸°ì¡´ ë¹¨ê°„ ê¸€ì”¨ ëŒ€ì‹  page-title-card ì‚¬ìš© -->
<div class="page-title-card">
    <h2>ğŸ  ë²„ë””ì˜ ì‹¤ë‚´ ì‚¬ì§„</h2>
    <p>ë²„ë””ë‘ ì°ì€ ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ì‹¤ë‚´ ì‚¬ì§„ë“¤ì„ ë§ˆìŒê» ë³´ì„¸ìš”.</p>
</div>

<div id="mediacontainer">
    <!-- ì‹¤ë‚´ ì‚¬ì§„ ì—¬ê¸°ë‹¤ê°€ -->
    <a href="#lightbox1"><img th:src="@{/images/1715754156273.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 1"></a>
    <a href="#lightbox2"><img th:src="@{/images/1715754070737.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 2"></a>
    <a href="#lightbox3"><img th:src="@{/images/1717999829447.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 3"></a>
    <a href="#lightbox4"><img th:src="@{/images/1717999914277.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 4"></a>
    <a href="#lightbox5"><img th:src="@{/images/1717999954763.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 5"></a>

    <div id="lightbox1" class="lightbox">
        <img th:src="@{/images/1715754156273.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 1">
    </div>
    <div id="lightbox2" class="lightbox">
        <img th:src="@{/images/1715754070737.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 2">
    </div>
    <div id="lightbox3" class="lightbox">
        <img th:src="@{/images/1717999829447.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 3">
    </div>
    <div id="lightbox4" class="lightbox">
        <img th:src="@{/images/1717999914277.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 4">
    </div>
    <div id="lightbox5" class="lightbox">
        <img th:src="@{/images/1717999954763.jpg}" alt="ë²„ë”” ì‹¤ë‚´ ì‚¬ì§„ 5">
    </div>
</div>
<section id="comments">
    <h3>ğŸ’¬ ëŒ“ê¸€</h3>

    <!-- ë¡œê·¸ì¸ ì•ˆ í•œ ìƒíƒœ -->
    <div sec:authorize="!isAuthenticated()">
        <p>ëŒ“ê¸€ì„ ì“°ë ¤ë©´ <a th:href="@{/login}">ë¡œê·¸ì¸</a> í•´ì•¼ í•©ë‹ˆë‹¤.</p>
    </div>

    <!-- ë¡œê·¸ì¸ í•œ ìƒíƒœì¼ ë•Œë§Œ ì‘ì„± ê°€ëŠ¥ -->
    <form sec:authorize="isAuthenticated()"
          th:action="@{/comments}" method="post">
        <!-- í˜„ì¬ í˜ì´ì§€ êµ¬ë¶„ -->
        <input type="hidden" name="pageId" th:value="${pageId}">
        <textarea name="content" rows="3" required placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
    </form>

    <ul>
        <li th:each="comment : ${comments}">
            <strong th:text="${comment.author.name}">ì‘ì„±ì</strong>
            <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
            <p th:text="${comment.content}"></p>

            <!-- ì‘ì„±ì ë³¸ì¸ ë˜ëŠ” ê´€ë¦¬ìë§Œ ì‚­ì œ ë²„íŠ¼ ë³´ì„ -->
            <div sec:authorize="isAuthenticated()"
                 th:if="${#authentication != null and
             (#authentication.principal.username == comment.author.email
              or #authorization.expression('hasRole(''ADMIN'')'))}">
                <form th:action="@{'/comments/' + ${comment.id} + '/delete'}"
                      method="post"
                      onsubmit="return confirm('í•´ë‹¹ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    <input type="hidden" name="pageId" th:value="${pageId}">
                    <button type="submit">ì‚­ì œ</button>
                </form>
            </div>
        </li>
    </ul>
</section>

<footer>
    <p id="footer-year">&copy; <span id="current-year"></span> My Homepage. All rights reserved.</p>
</footer>

<script>
    // JavaScriptë¡œ ë…„ë„ ì‰½ê²Œ ì—…ë°ì´íŠ¸í•˜ê¸°
    document.getElementById('current-year').textContent = new Date().getFullYear();
</script>
</body>
</html>