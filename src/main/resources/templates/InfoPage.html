<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>버디에 대하여</title>

    <!-- ✅ 배경/헤더/네비/인포 박스: common.css -->
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <!-- ✅ 댓글 섹션 스타일: comments.css -->
    <link rel="stylesheet" th:href="@{/css/comments.css}">
</head>
<body>
<div class="login-area">
    <!-- 로그인 안 한 상태 -->
    <form sec:authorize="!isAuthenticated()" th:action="@{/login}" method="get">
        <button type="submit">로그인</button>
    </form>

    <!-- 로그인 한 상태 -->
    <form sec:authorize="isAuthenticated()"
          th:action="@{/logout}" method="post">
        <span sec:authentication="principal.username">user</span>
        <button type="submit">로그아웃</button>
    </form>
</div>

<header id="container">
    <h1>버디에 대하여</h1>
</header>

<nav>
    <ul>
        <li><a th:href="@{/home}">홈</a></li>
        <li><a th:href="@{/photos}">사진</a></li>
        <li><a th:href="@{/videos}">동영상</a></li>
        <li><a th:href="@{/info}">정보</a></li>
    </ul>
</nav>

<div id="info-box">
    <h2>버디에 대하여</h2>
    <p>이름: 버디</p>
    <p>생일: 7월 13일</p>
    <p>종: 골든 리트리버</p>
    <p>버디는 간식과 산책을 좋아하는 강아지 입니다. 우리 집에는 2020년 9월 경에 왔습니다. 처음에 30cm 정도의 길이였던 녀석이 엄청 컸네요.</p>
</div>

<section id="comments">
    <h3>💬 댓글</h3>

    <!-- 로그인 안 한 상태 -->
    <div sec:authorize="!isAuthenticated()">
        <p>댓글을 쓰려면 <a th:href="@{/login}">로그인</a> 해야 합니다.</p>
    </div>

    <!-- 로그인 한 상태일 때만 작성 가능 -->
    <form sec:authorize="isAuthenticated()"
          th:action="@{/comments}" method="post">
        <!-- 현재 페이지 구분 -->
        <input type="hidden" name="pageId" th:value="${pageId}">
        <textarea name="content" rows="3" required placeholder="댓글을 입력하세요..."></textarea>
        <button type="submit">댓글 작성</button>
    </form>

    <ul>
        <li th:each="comment : ${comments}">
            <strong th:text="${comment.author.name}">작성자</strong>
            <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
            <p th:text="${comment.content}"></p>

            <!-- 작성자 본인 또는 관리자만 삭제 버튼 보임 -->
            <div sec:authorize="isAuthenticated()"
                 th:if="${#authentication != null and
             (#authentication.principal.username == comment.author.email
              or #authorization.expression('hasRole(''ADMIN'')'))}">
                <form th:action="@{'/comments/' + ${comment.id} + '/delete'}"
                      method="post"
                      onsubmit="return confirm('해당 댓글을 삭제하시겠습니까?');">
                    <input type="hidden" name="pageId" th:value="${pageId}">
                    <button type="submit">삭제</button>
                </form>
            </div>
        </li>
    </ul>
</section>

<footer>
    <p id="footer-year">&copy; <span id="current-year"></span> My Homepage. All rights reserved.</p>
</footer>

<script>
    // JavaScript로 년도 쉽게 업데이트하기
    document.getElementById('current-year').textContent = new Date().getFullYear();
</script>
</body>
</html>


